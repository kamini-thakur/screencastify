"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)}!function(){angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,r){var n={};return n.wrapChromeError=function(r,n){return function(){var t=Array.prototype.slice.call(arguments,0),o=e.defer();return t.push(function(e){chrome.runtime.lastError?o.reject(chrome.runtime.lastError):o.resolve(e)}),r.apply(n,t),o.promise}},n.wrapCallbacks=function(r,n){return function(){var t=Array.prototype.slice.call(arguments,0),o=e.defer();return t.push(o.resolve.bind(o)),t.push(o.reject.bind(o)),r.apply(n,t),o.promise}},n.serializer=function(){var r=null,n=function(n){var t=e.defer();return(r||e.when())["finally"](function(){var e=n.call();t.resolve(e)}),r=t.promise,r["finally"](function(){r=null}),t.promise};return n.wrap=function(e){return function(){return n(e.bind.apply(e,[this].concat(Array.prototype.slice.call(arguments))))}},n},n.withTimeout=function(n,t,o){o||(o=angular.noop);var i=e.defer(),a=r(function(){var e=o();angular.isDefined(e)?i.resolve(e):i.reject("timeout"),i=null},t),u=n(),s=i.promise;return u["finally"](function(){r.cancel(a),a=null}),u.then(function(){i&&i.resolve.apply(i,arguments)},function(){i&&i.reject.apply(i,arguments)}),s},n}]),angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var r={};return r.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),r.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),r.connect=chrome.runtime.connect.bind(chrome.runtime),r.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),r.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(r.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),r.setUninstallURL=e.wrapChromeError(chrome.runtime.setUninstallURL,chrome.runtime),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach(function(e){r[e]={addListener:function(r){chrome.runtime[e].addListener(r)},removeListener:function(r){chrome.runtime[e].removeListener(r)}}}),r}]),angular.module("w69b.timeutil",[]).factory("timeutil",function(){var e={};return e.formatDuration=function(e){function r(e){return e<10?"0"+e:e}angular.isNumber(e)||(e=0);var n="";e<0&&(n="-",e=-e+.99);var t=Math.floor(e%60),o=Math.floor(e/60%60),i=[r(o),r(t)],a=Math.floor(e/3600);return a&&i.unshift(a),n+i.join(":")},e}).filter("duration",["timeutil",function(e){return function(r){return e.formatDuration(r||0)}}]),angular.module("w69b.chromePermissions",["w69b.promiseTool"]).factory("chromePermissions",["promiseTool",function(e){var r=window.chrome&&window.chrome.permissions,n={};return r?(n.contains=e.wrapChromeError(r.contains,r),n.request=e.wrapChromeError(r.request,r),n.remove=e.wrapChromeError(r.remove,r),n.getAll=e.wrapChromeError(r.getAll,r),n):n}]),angular.module("w69b.spawn",[]).factory("spawn",["$q",function(e){function r(r,n){function t(e,r){var n;try{n=e(r)}catch(t){return o(t)}return n.done?i(n.value):i(n.value).then(u,s)}var o=n?Promise.reject.bind(Promise):e.reject.bind(e),i=n?Promise.resolve.bind(Promise):e.when.bind(e),a=r(),u=t.bind(null,a.next.bind(a)),s=t.bind(null,a["throw"].bind(a));return u()}return r.wrap=function(e){return function(){var n=arguments;return r(e.bind.apply(e,[this].concat(_toConsumableArray(n))))}},r}]),angular.module("castifyExt.recorder",["castifyExt.backgroundTool","castifyExt.optionalPermissions","w69b.spawn"]).factory("recorder",["backgroundTool","optionalPermissions","spawn","$q",function(e,r,n,t){var o=e.portHelper("recorder",!1),i=t.defer(),a={};a.info={},a.connectedPromise=i.promise;var u={};return u.stateUpdate=function(e){angular.copy(e,a.info),i&&(i.resolve(),i=null)},o.installHandlers(u),a.getState=function(){return a.connectedPromise.then(function(){return a.info})},a.start=n.wrap(regeneratorRuntime.mark(function s(e){var n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if("tab"!==e.captureSource){i.next=6;break}return i.next=3,r.requestTabPermissions(e);case 3:if(n=i.sent){i.next=6;break}return i.abrupt("return",t.reject("tab_permissions"));case 6:return i.abrupt("return",o.postMessage("start",e));case 7:case"end":return i.stop()}},s,this)})),a.stop=function(){o.postMessage("stop")},a.restart=function(){o.postMessage("restart")},a.pause=function(){o.postMessage("pause")},a.resume=function(){o.postMessage("resume")},a.replaceStream=function(e){o.postMessage("replaceStream",e)},a.cancelPendingStart=function(){o.postMessage("cancelPendingStart")},a.showPreview=function(e){o.postMessage("showPreview",e)},a.setAutoStop=function(e){o.postMessage("setAutoStop",e)},o.getPort(),a}]),angular.module("castifyExt.backgroundTool",["w69b.chromeRuntime"]).factory("backgroundTool",["chromeRuntime","$q","$log","$rootScope",function(e,r,n,t){function o(){var n=r.defer();return e.onMessage.addListener(function t(r){"bg:loaded"===r&&(e.onMessage.removeListener(t),n.resolve())}),e.sendMessage("bg:load")["catch"](angular.identity),n.promise}var i,a={};return a.portHelper=function(n,i){var a,u={};return u.getPort=function(){var t=i===!1?r.when():o();return t.then(function(){return a||(a=e.connect({name:n})),a})},u.postMessage=function(e,r){return u.getPort().then(function(n){return n.postMessage({type:e,data:r})})},u.installHandlers=function(e){function r(r){e.hasOwnProperty(r.type)&&e[r.type](r.data),t.$$phase||t.$apply()}function n(){u.getPort().then(function(e){e.onMessage.removeListener(r)})}return u.getPort().then(function(e){e.onMessage.addListener(r)}),n},u},a.loadBackground=function(){return i||(i=o()),i},a}]),angular.module("castifyExt.ui.themeConfig",["ngMaterial"]).config(["$mdThemingProvider",function(e){e.definePalette("castify",{50:"f5f5f5",100:"555555",200:"ef9a9a",300:"e57373",400:"ef5350",500:"ff8282",600:"e53935",700:"d32f2f",800:"c62828",900:"b71c1c",A100:"fd8c00",A200:"ff8282",A400:"00aaff",A700:"d50000"}),e.theme("default").primaryPalette("castify",{"default":"500","hue-1":"A100","hue-2":"A200","hue-3":"A400"}).accentPalette("pink")}]).config(["$mdIconProvider",function(e){e.defaultIconSet("gen/icons.svg")}]),angular.module("castifyExt.ui.livepreview",["w69b.promiseTool","w69b.timeutil","castifyExt.recorder","castifyExt.ui.loadingOverlay","ngMaterial"]).directive("cfLivePreviewCanvas",["recorder",function(e){return{restrict:"EA",templateUrl:"components/castifyExt/ui/livepreview/livePreviewCanvas.html",replace:!0,scope:{},link:function(r,n,t){var o=n.find("video"),i=o.eq(0);i[0].volume=0,i.bind("canplay",function(){i.removeClass("ng-hide")}),r.$watch(function(){return"cam"===e.info.config.captureSource?e.info.videoUrl:e.info.cameraUrl},function(e){e&&i.attr("src",e)})}}}]).controller("LivePreviewCtrl",["$scope","recorder",function(e,r){e.recorder=r}]),angular.module("castifyExt.ui.loadingOverlay",[]).directive("cfLoadingBackdrop",function(){return{restrict:"E",template:'<md-progress-circular md-mode="indeterminate"></md-progress-circular>'}}).directive("cfLoadingOverlay",["$compile",function(e){return{restrict:"A",link:function(r,n,t){var o=null;r.$watch(t.cfLoadingOverlay,function(t){t?(o=e("<cf-loading-backdrop></cf-loading-backdrop>")(r),n.append(o)):o&&(o.remove(),o=null)})}}}]),angular.module("castifyExt.optionalPermissions",["w69b.chromePermissions"]).factory("optionalPermissions",["chromePermissions",function(e){function r(e){return e&&(!e.draw||e.draw&&!e.draw.showToolbox)?o:t}var n={},t={permissions:["tabCapture","webNavigation","activeTab"],origins:["<all_urls>"]},o={permissions:["tabCapture","webNavigation","activeTab"],origins:[]};return n.hasLiteTabPermissions=function(){return e.contains(o)},n.hasTabPermissions=function(n){return e.contains(r(n))},n.requestTabPermissions=function(n){return e.request(r(n))},n}]),angular.module("castifyExt.LivePreviewApp",["castifyExt.ui.livepreview","castifyExt.ui.themeConfig"]).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**"])}]),angular.module("castifyExt.LivePreviewApp").requires.push("templates")}();